<?php
    session_start();
    //$query1 = "SELECT @topping_id:=id FROM topping WHERE name ='pomodoro';";
    //$query2 = "SELECT @pizza_id:=pizza_id FROM pizza_topping WHERE topping_id=@topping_id;";
    //$query3 = "SELECT * FROM pizza WHERE id=@pizza_id;";
    if (isset($_POST['topping_name'])) {
        require_once 'db-topping.php';
        require_once 'db-pizza_topping.php';
        require_once 'db-pizza.php';

        $topping_name = $_POST['topping_name'];

        $topping = getTopping($topping_name);
        $pizza_topping_ids = getPizzaToppingIds($topping["id"]);

        //$pizza_ids = getPizzIdsFromPizzaToppingIds($pizza_topping_ids)
        $pizza_ids = [];
        foreach($pizza_topping_ids as $pizza_topping_id) {
            $pizza_id = $pizza_topping_id["pizza_id"];
            array_push($pizza_ids, $pizza_id);
        } 

        $pizzas = getPizzas($pizza_ids);
        $_SESSION['pizzas'] = $pizzas;

        header("Location: ../reservedpage.php?error=none");
    } else{
        header("Location: ../reservedpage.php");
    }